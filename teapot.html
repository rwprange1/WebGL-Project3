<!DOCTYPE html>
<html>

<title>Teapot</title>

<script id="vertex-shader" type="x-shader/x-vertex">

precision mediump float;

attribute vec4 vPosition, vNorm;
uniform mat4 uCamera,  uPerspectiveMatrix;
uniform vec4 uRotQuat, lightPos, viewerPos;

varying vec3 N, L,E;








/**
    the format for a quat vec4 (scale, vec3)
    function multiplies two quaternions
*/
vec4 multq(vec4 a, vec4 b){
    return vec4(a.x * b.x - dot(a.yzw, b.yzw),
        cross(b.yzw, a.yzw) + a.yzw *  b.x  + b.yzw * a.x    
    );
}


vec4 invq(vec4 a){
    return (vec4(a.x, -a.yzw)/dot(a,a));
}

vec4 rotate(vec4 vPosition){
    vec4 p = vec4(0.0, vPosition.xyz);
    p = multq(uRotQuat, multq(p, invq(uRotQuat)));
    return vec4(p.yzw, 1.0);
}

void main() {
    gl_PointSize = 3.0;
    vec4 newPos = rotate(vPosition); // gets the rotationed position of the vertex
    vec4 newNorm = rotate(vNorm);

    vec3 posEye = (uCamera * newPos).xyz;
    vec3 lightEye = (uCamera * lightPos).xyz;

    L = normalize(lightEye - posEye);
    N = normalize((mat3(uCamera) * newNorm.xyz));
    E = (viewerPos.xyz - posEye);

    gl_Position =  uPerspectiveMatrix * uCamera  * newPos; 
    
}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">

precision mediump float;


uniform vec4 ambientProduct, diffuseProduct, specularProduct, uColor;
uniform float shininess;


varying vec3 N, L, E;


void main() {
    vec4 fColor;
    vec3 H = normalize(L+E);
    vec4 ambient = ambientProduct;
    float k_d = max(dot(L,N), 0.0);
    vec4 diffuse = k_d * diffuseProduct;

    float k_s = pow(max(dot(N,H), 0.0), shininess);
    vec4 specular = k_s * specularProduct;

    if (dot(L,N) < 0.0 ){
        specular = vec4(0.0, 0.0, 0.0, 1.0);
    }
    fColor = (ambient + diffuse + specular) * uColor;
    fColor.a = 1.0;
    
   
    gl_FragColor = fColor;
}

</script>



<head>
<!--Changed file path-->
<script type="text/javascript" src="common_files/utils.js"></script>
<script type="text/javascript" src="main.js"></script>
<script type="text/javascript" src="MV.js"></script>
<script type="text/javascript" src="Camera.js"></script>
<script type="text/javascript" src="./createTeapotData.js"></script>
<script type="text/javascript" src="./patches.js"></script>
<script type="text/javascript" src="./vertices.js"></script>
<script type="text/javascript" src="quaternion.js"></script>

<link rel="stylesheet" href="style.css">
</head>   

<body style="background-color: blueviolet;">
    <div class="flex-container">
        <div class="column" >
            <canvas id="gl-canvas" width="512" height="512"  >
            Oops ... your browser doesn't support the HTML5 canvas element
            </canvas>
            <div id="cameraPos" ></div>
        </div>
        <div class="column">
            <h1>Control Panel</h1>

            <h2 style="text-align: left ;">Light Source Position</h2>
            <div class="light">
                

                <h1 style="display: flex; flex-direction: column;">
                    X: (0.0 - 1.0)
                    <input type="range" value=".2" min="0.0" max="1.0" class="slider" step=".05" id="light-x-slider" />
                </h1>

                <h1 style="display: flex; flex-direction: column;">
                    Y: (0.0 - 1.0)
                    <input type="range" value=".2" min="0.0" max="1.0" class="slider" step=".05" id="light-y-slider" />

                </h1>

                <h1 style="display: flex; flex-direction: column;">
                    Z: (0.0 - 1.0)
                    <input type="range" value=".2" min="0.0" max="1.0" class="slider" step=".05" id="light-z-slider" />
                </h1>
            </div>
            

            <h2 style="text-align: left ;">Light Properties</h2>
            <div class="light">
                

                <h1 style="display: flex; flex-direction: column;">
                    Light Intensity (Diffuse): (1.0 - 5.0)
                    <input type="range" value=".5" min="1.0" max="5.0" class="slider" step=".25" id="diffuse-slider" />
                </h1>

                <h1 style="display: flex; flex-direction: column;">
                    Light Intensity (Specular): (1.0 - 5.0)
                    <input type="range" value=".5" min="1.0" max="5.0" class="slider" step=".25" id="spec-slider" />
                </h1>

               
            </div>

            <h2 style="text-align: left ;">Diffuse Reflectivity Constants</h2>
            <div class="light">
                

                <h1 style="display: flex; flex-direction: column;">
                    Red: (0.0 - 1.0)
                    <input type="range" value=".5" min="1.0" max="5.0" class="slider" step=".25" id="diffuse-r-slider" />
                </h1>

                <h1 style="display: flex; flex-direction: column;">
                    Green: (0.0 - 1.0)
                    <input type="range" value=".5" min="1.0" max="5.0" class="slider" step=".25" id="diffuse-g-slider" />
                </h1>

                <h1 style="display: flex; flex-direction: column;">
                    Blue: (0.0 - 1.0)
                    <input type="range" value=".5" min="1.0" max="5.0" class="slider" step=".25" id="diffuse-b-slider" />
                </h1>

               
            </div>

              <h2 style="text-align: left ;">Specular Reflectivity Constants</h2>
            <div class="light">
                

                <h1 style="display: flex; flex-direction: column;">
                    Red: (0.0 - 1.0)
                    <input type="range" value=".5" min="1.0" max="5.0" class="slider" step=".25" id="spec-r-slider" />
                </h1>

                <h1 style="display: flex; flex-direction: column;">
                    Green: (0.0 - 1.0)
                    <input type="range" value=".5" min="1.0" max="5.0" class="slider" step=".25" id="spec-g-slider" />
                </h1>

                <h1 style="display: flex; flex-direction: column;">
                    Blue: (0.0 - 1.0)
                    <input type="range" value=".5" min="1.0" max="5.0" class="slider" step=".25" id="spec-b-slider" />
                </h1>

               
            </div>




           

            </h1>
            <h1>
                <button id="reset">Reset World</button>
            </h1>
            
        </div>



    </div>










</body>
</html>
